{%load i18n repositories %}
{% comment %}Requires the list of projects in "projects"{% endcomment %}
<span class="repository">
  <span class="bubble">
    <span class="list">
      <table>
        {% if compact %}<tr class="bubble_title"><td>{% trans "Latest software activities" %}</td></tr>{% endif %}
        <tr>
          <td class="buble_contents">
            <table class="inner">
              {% if not compact %}
              <tr>
                <th>{% trans "Project" %}</th>
                <th>{% trans "Version" %}</th>
                <th>{% trans "Description" %}</th>
                <th>{% trans "Last change" %}</th>
              </tr>
              {% endif %}
              {% for p in projects %}
              <tr class="{% cycle 'even' 'odd' %}">
                <td class="project_name"><a href="{% url djpro:view-project p.slug %}">{{ p.name }}</a></td>
                {% if p.repo.tags %}
                {% with p.repo.tags|reverse as tl %}
                <td class="tags"><a href="{% url djpro:download-release %}?r={{ p.repo.path|name }}&tag={{ tl.0.name }}" title="{% trans 'download release' %} {{ tl.0.name }}"><span class="tag">{{ tl.0.name }}</span></a></td>
                {% endwith %}
                {% else %}
                {% comment %}If the user has no tags, we offer the heads{% endcomment %}
                <td class="heads">
                  {% for head in p.repo.heads %}
                  <a href="{% url djpro:download-release %}?r={{ p.repo.path|name }}&head={{ head.name }}" title="{% trans 'download head' %} {{ head.name }}"><span class="head">{{ head.name }}</span><br/></a>
                  {% endfor %}
                </td>
                {% endif %}
                <td class="summary">{% if not compact %}{{ p.repo.description }}{% else %}{{ p.repo.description|truncatewords:"8" }}{% endif %}</td>
                <td>{{ p.updated|timesince }} {% trans "ago" %}</td> 
              </tr>
              {% endfor %}
            </table>
          </td>
        </tr>
      </table>
    </span><!-- ends class="list" -->
  </span><!-- ends class="bubble" -->
</span><!-- ends class="repository" -->
