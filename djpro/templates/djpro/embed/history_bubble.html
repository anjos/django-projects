{% load i18n repositories embed %}
{% comment %}requires "repo", "path", "latest-commit", and "commits"{% endcomment %}
<span class="bubble">
  <span class="tree">
    <table>
      <tr class="bubble_title"><td>{% trans "History" %}</td></tr>
      <tr class="path"><td><a href="{% url djpro:view-tree latest %}?r={{ repo.path|name }}">[root]</a>{% for p in  path|slice:":-1" %} / <a href="{% url djpro:view-tree latest %}?r={{ repo.path|name }}{% if p %}&t={{ p }}{% endif %}">{{ p|split:"/"|last }}</a>{% endfor %} / {{ path|last|split:"/"|last }}</td></tr>
      <tr><td> 

        <table>
          <tr><th colspan="4">{% trans "actions" %}</th>
            <th>{% trans "mode" %}</th>
            <th>{% trans "path" %}</th>
            <th>{% trans "date" %}</th>
            <th>{% trans "author" %}</th>
            <th>{% trans "summary" %}</th>
            <th>{% trans "information" %}</th>
          </tr>
        {% for commit,d in commits %}
        <!-- {% cycle 'even' 'odd' as oddity %} -->
        {% if d.deleted_file %}<tr class="deleted {{ oddity }}">
        {% else %}{% if d.new_file %}<tr class="new {{ oddity }}">
        {% else %}{% if d.renamed %}<tr class="renamed {{ oddity }}">
        {% else %}<tr class="{{ oddity }}">
        {% endif %}{% endif %}{% endif %}
        <td class="action"><a href="{% url djpro:view-diff commit %}?r={{ repo.path|name }}&b={{ d.b_path }}" title="{% trans 'view differences done at this file for this commit' %}">{% trans "diff" %}</a></td>
        <td class="action">{% if not d.deleted_file %}<a href="{% url djpro:view-blob commit %}?r={{ repo.path|name }}&b={{ d.b_path }}" title="{% trans 'view this file after this commit' %}">{% trans "view" %}</a>{% else %}{% trans "view" %}{% endif %}</td>
        <td class="action">{% if not d.deleted_file %}<a href="{% url djpro:view-raw commit %}?r={{ repo.path|name }}&b={{ d.b_path }}" title="{% trans 'download this file' %}">{% trans "download" %}</a>{% else %}{% trans "download" %}{% endif %}</td>
        <td class="action"><a href="{% url djpro:view-commit commit %}?r={{ repo.path|name }}" title="{% trans 'view the whole commit and its changes' %}">{% trans "commit" %}</a></td>
        <td class="mode">{% if d.a_mode %}{{ d.a_mode|mode }}{% else %}{% if d.b_mode %}{{ d.b_mode|mode }}{% else %}-----------{% endif %}{% endif %}</td>
        <td class="path">{{ d.b_path }}</td>
        <td class="date">{{ commit.committed_date|relative_date }}</td>
        <td class="author">{{ commit.committer.name }}</td>
        <td class="summary">{{ commit.summary }}</td>
        <td class="information">
        {% if d.renamed %}
        {% trans "was" %} {{ d.a_path }}{% if d.a_mode %} ({{ d.a_mode|mode }}){% endif %}
        {% else %}{% if d.new_file %}{% trans "created" %}
        {% else %}{% if d.deleted_file %}{% trans "deleted" %}
        {% endif %}{% endif %}{% endif %}
        </td>
        </tr>
        {% endfor %}
        </table>

      </td></tr>

    </table>
  </span><!-- class="tree" -->
</span><!-- class="bubble" -->
