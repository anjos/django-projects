{% extends "base.html" %}
{% load i18n %}

{% load repositories %}

{% block media %}
  {{ block.super }}
  <link href="{{ MEDIA_URL }}djpro/css/repo.css" rel="stylesheet" type="text/css" media="screen" />
{% endblock %}

{% block title %}{% trans "Repository" %} {{ repo.path|name }}{% endblock %}

{% block content %}

  <div class="repository">
    <div class="summary">
      <p>{% trans "Summary" %}</p>
      <table>
        <tr><th>{% trans "description" %}</th><td>{{ repo.description }}</td></tr>
        <tr><th>{% trans "last change" %}</th><td>{{ repo.commits.0.committed_date|tuple_to_date|date:"r" }}</td></tr>
        <!--<tr><th>{% trans "url" %}</th><td></td></tr>-->
      </table>
    </div>

    {% if repo.heads %}
    <div class="heads">
      <p>{% trans "Heads" %}</p>
      <ul>
          {% for head in repo.heads %}
          <li>{{ head.name }}</li>
          {% endfor %}
      </ul>
    </div>
    {% endif %}

    <div class="shortlog">
      <p>{% trans "Shortlog" %} ({{ repo.commit_count }} {% trans "commits" %})</p>
      <table>
        <tr><th colspan="4">{% trans "actions" %}</th>
            <th>{% trans "date" %}</th>
            <th>{% trans "author" %}</th>
            <th colspan="3">{% trans "statistics" %}</th>
            <th>{% trans "summary" %}</th>
        </tr>
        {% for commit in commits %}
        <tr>
          <td class="action"><a href="{% url djpro:view-commit commit %}?r={{ repo.path|name }}">{% trans "commit" %}</a></td>
          <td class="action"><a href="{% url djpro:view-diff commit %}?r={{ repo.path|name }}">{% trans "diff" %}</a></td>
          <td class="action"><a href="{% url djpro:view-tree commit %}?r={{ repo.path|name }}">{% trans "tree" %}</a></td>
          <td class="action"><a href="{% url djpro:download-tree commit %}?r={{ repo.path|name }}">{% trans "download" %}</a></td>
          <td class="date">{{ commit.committed_date|tuple_to_date|date:"d/F/Y" }}</td>
          <td class="author">{{ commit.committer.name }}</td>
          <td class="lines-added">+{{ commit.stats.total.insertions }}</td>
          <td class="lines-removed">-{{ commit.stats.total.deletions }}</td>
          <td class="number-of-files">@{{ commit.stats.total.files }}</td>
          <td class="summary">{{ commit.summary }}</td>
        </tr>
        {% endfor %}
      </table>
    </div>

  </div>
{% endblock %}
